# .htaccess FINAL para carpeta debug
# Configuración definitiva para herramientas de debug web-only

# ===== VERIFICACIÓN DE IP =====
<RequireAll>
    # Permitir acceso solo desde IPs autorizadas
    Require ip 127.0.0.1
    Require ip ::1
    # REEMPLAZA 'TU_IP_PUBLICA_AQUI' con tu IP pública real
    # Ejemplo: Require ip 203.0.113.42
    Require ip 181.72.88.67
</RequireAll>

# ===== SEGURIDAD GENERAL =====
Options -Indexes

# ===== CONTROL DE ACCESO A ARCHIVOS =====

# Permitir SOLO archivos específicos de herramientas de debug
<FilesMatch "^(web_debug_panel|web_debug_actions|log_viewer|db_analyzer|GUIA_DEBUG_WEB_ONLY|USO_RAPIDO)\.php$">
    <RequireAll>
        Require all granted
    </RequireAll>
</FilesMatch>

# Permitir archivos de documentación
<FilesMatch "\.(md|txt)$">
    <RequireAll>
        Require all granted
    </RequireAll>
</FilesMatch>

# Denegar acceso a cualquier otro archivo PHP
<FilesMatch "\.php$">
    <RequireAll>
        Require all denied
    </RequireAll>
</FilesMatch>

# Bloquear acceso a archivos sensibles
<FilesMatch "\.(log|sql|env|bak|backup|old|tmp|temp)$">
    <RequireAll>
        Require all denied
    </RequireAll>
</FilesMatch>

# ===== HEADERS DE SEGURIDAD =====
<IfModule mod_headers.c>
    # Prevenir clickjacking
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # Prevenir MIME type sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # Activar protección XSS
    Header always set X-XSS-Protection "1; mode=block"
    
    # Política de referrer
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Cache control para herramientas de debug (sin cache)
    Header always set Cache-Control "no-cache, no-store, must-revalidate, private"
    Header always set Pragma "no-cache"
    Header always set Expires "0"
    
    # Content Security Policy para debugging
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'"
</IfModule>

# ===== PREVENCIÓN DE ATAQUES =====

# Prevenir ejecución de archivos subidos maliciosos
<FilesMatch "\.(phar|php[0-9]?|phtml|php3|php4|php5)$">
    <RequireAll>
        Require all denied
    </RequireAll>
</FilesMatch>

# Prevenir acceso a archivos de configuración
<FilesMatch "\.(conf|config|ini|cfg)$">
    <RequireAll>
        Require all denied
    </RequireAll>
</FilesMatch>

# ===== LOGGING DE ACCESOS =====
<IfModule mod_log_config.c>
    # Log específico para debug (si está disponible)
    # CustomLog logs/debug_access.log combined
</IfModule>

# ===== OPTIMIZACIÓN =====
<IfModule mod_deflate.c>
    # Comprimir archivos de documentación
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/javascript
</IfModule>

# ===== REDIRECCIÓN DE SEGURIDAD =====
<IfModule mod_rewrite.c>
    RewriteEngine Off
    
    # Si alguien intenta acceder a archivos prohibidos, redirigir
    RewriteCond %{REQUEST_FILENAME} \.(php|phar|phtml)$
    RewriteCond %{REQUEST_FILENAME} !^(web_debug_panel|web_debug_actions|log_viewer|db_analyzer)\.php$
    RewriteRule ^ - [F,L]
</IfModule>